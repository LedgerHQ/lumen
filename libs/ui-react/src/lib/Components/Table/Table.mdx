import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as TableStories from './Table.stories';
import {
  CustomTabs,
  Tab,
} from '../../../../.storybook/components';

<Meta title='Components/Table' of={TableStories} />

# Table

<CustomTabs>
  <Tab label="Overview ">

## Introduction

The Table component provides a structured way to display tabular data with support for sorting, responsive hiding, clickable rows, infinite scroll, and action bars.

> View in [Figma](https://www.figma.com/design/JxaLVMTWirCpU0rsbZ30k7/2.-Components-Library?node-id=11618-5962&m=dev).

## Anatomy

<Canvas of={TableStories.Base} />

The Table is composed of the following sub-components:

- **TableRoot**: Outer scroll container with appearance variants and scroll handling
- **Table**: HTML `<table>` wrapper with `table-fixed` layout
- **TableHeader / TableHeaderRow / TableHeaderCell**: Header structure with sticky positioning
- **TableBody / TableRow / TableCell**: Body structure with responsive hiding and alignment
- **TableCellContent**: Structured cell layout with optional leading icon, title, and description
- **TableSortButton**: Sortable header button with ascending/descending indicators
- **TableInfoIcon**: Information icon for header tooltips
- **TableActionBar / TableActionBarLeading / TableActionBarTrailing**: Controls above the table
- **TableLoadingRow**: Loading indicator for infinite scroll

<Controls of={TableStories.Base} />

## Properties

### Appearance

The `TableRoot` component supports two appearance modes:

- `no-background` (default): uses the canvas background, ideal when the table sits directly on the page
- `plain`: uses a surface background, useful when the table needs visual separation from its surroundings

<Canvas of={TableStories.AppearanceShowcase} />

### Responsive Layout

Columns can be hidden below specific breakpoints using the `hideBelow` prop on both `TableHeaderCell` and `TableCell`. Make sure to apply `hideBelow` to matching header and body cells so they stay in sync. Long header text is automatically truncated with ellipsis.

<Canvas of={TableStories.ResponsiveLayout} />

### Clickable Rows

Set `clickable` on `TableRow` to enable hover and active background states, and pass an `onClick` handler. This adds `role="button"` for accessibility. Use this when rows navigate to a detail view or trigger an action.

<Canvas of={TableStories.WithClickableRow} />

### Custom Header

Header cells can combine `TableSortButton` for sortable columns and `TableInfoIcon` (wrapped in a `Tooltip`) for contextual information. When a column has both a sort control and an info icon, place them as siblings inside `TableHeaderCell`. Use the `align` prop on `TableSortButton` to match the cell alignment (e.g. `align="right"` for numeric columns).

<Canvas of={TableStories.WithCustomHeader} />

### Action Bar

The `TableActionBar` sits above the table and splits into `TableActionBarLeading` (left-aligned, typically search/filter) and `TableActionBarTrailing` (right-aligned, typically export/action buttons). It is rendered outside `TableRoot` so it doesn't scroll with the table content.

<Canvas of={TableStories.WithActionBar} />

### Infinite Loading

Pass `onScrollBottom` to `TableRoot` to fire a callback when the user scrolls near the bottom. Set `isLoading` to `true` while fetching to prevent duplicate calls. Place `TableLoadingRow` outside the `<Table>` but inside `TableRoot` -- it only renders when `isLoading` is true. A fixed height on `TableRoot` (e.g. `className="h-480"`) is required to enable scrolling.

<Canvas of={TableStories.WithInfiniteLoading} />

## Accessibility

To be implemented:

- Keyboard navigation between rows and cells
- ARIA attributes for sortable columns
- Screen reader announcements for loading states

</Tab> <Tab label="Implementation ">

## Installation

```bash
npm install @ledgerhq/lumen-ui-react
```

> **Note**: `@ledgerhq/lumen-design-core` and other peer dependencies (`react`, `tailwindcss`, `clsx`, etc.) are required. See our [Setup Guide](?path=/docs/getting-started-setup-tailwind--docs#1-tailwind-config) for complete installation and Tailwind configuration.

## Basic Usage

```tsx
import {
  TableRoot,
  Table,
  TableHeader,
  TableHeaderRow,
  TableHeaderCell,
  TableBody,
  TableRow,
  TableCell,
} from '@ledgerhq/lumen-ui-react';

function MyComponent() {
  return (
    <TableRoot>
      <Table>
        <TableHeader>
          <TableHeaderRow>
            <TableHeaderCell>Name</TableHeaderCell>
            <TableHeaderCell align='right'>Price</TableHeaderCell>
          </TableHeaderRow>
        </TableHeader>
        <TableBody>
          <TableRow>
            <TableCell>Bitcoin</TableCell>
            <TableCell align='right'>$43,250.00</TableCell>
          </TableRow>
        </TableBody>
      </Table>
    </TableRoot>
  );
}
```

## Advanced Patterns

### Sorting

Use `TableSortButton` inside `TableHeaderCell` to add sortable columns:

```tsx
import { TableSortButton } from '@ledgerhq/lumen-ui-react';
import { useState } from 'react';

function SortableTable() {
  const [sortDir, setSortDir] = useState(undefined);

  return (
    <TableHeaderCell>
      <TableSortButton
        sortDirection={sortDir}
        onToggleSort={setSortDir}
      >
        Name
      </TableSortButton>
    </TableHeaderCell>
  );
}
```

### Info Icon with Tooltip

Combine a truncatable `<span>` and `TableInfoIcon` inside a `TableHeaderCell`:

```tsx
import {
  TableHeaderCell,
  TableInfoIcon,
} from '@ledgerhq/lumen-ui-react';
import { Tooltip, TooltipTrigger, TooltipContent } from '@ledgerhq/lumen-ui-react';

<TableHeaderCell align='right'>
  <span className='truncate'>Market cap</span>
  <Tooltip>
    <TooltipTrigger asChild>
      <TableInfoIcon />
    </TooltipTrigger>
    <TooltipContent>Total market capitalization</TooltipContent>
  </Tooltip>
</TableHeaderCell>
```

### Infinite Scroll

Use `onScrollBottom` and `isLoading` on `TableRoot`, with `TableLoadingRow` at the bottom:

```tsx
<TableRoot
  className='h-480'
  isLoading={isLoading}
  onScrollBottom={loadMore}
>
  <Table>
    {/* ... */}
  </Table>
  <TableLoadingRow />
</TableRoot>
```

### Action Bar

Place `TableActionBar` above the table for search and action controls:

```tsx
import {
  TableActionBar,
  TableActionBarLeading,
  TableActionBarTrailing,
} from '@ledgerhq/lumen-ui-react';

<TableActionBar>
  <TableActionBarLeading>
    <SearchInput placeholder='Search...' />
  </TableActionBarLeading>
  <TableActionBarTrailing>
    <Button appearance='base' size='md'>Export</Button>
  </TableActionBarTrailing>
</TableActionBar>
```

</Tab>
</CustomTabs>
