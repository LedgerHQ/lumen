import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as AvatarStories from './Avatar.stories';
import {
  CustomTabs,
  Tab,
  DoVsDontRow,
  DoBlockItem,
  DontBlockItem,
} from '../../../../.storybook/components';
import CommonRulesDoAndDont from '../../../../.storybook/components/DoVsDont/CommonRulesDoAndDont.mdx';

<Meta title='Action/Avatar' of={AvatarStories} />

# ðŸ‘¤ Avatar

<CustomTabs>
  <Tab label="Overview">

## Introduction

The Avatar component displays a circular user profile image with automatic fallback to a User icon when the image is unavailable or fails to load. It supports an optional notification indicator and two size variants.

> View in [Figma](https://www.figma.com/design/JxaLVMTWirCpU0rsbZ30k7/2.-Components-Library?node-id=10546-614&p=f&m=dev).

## Anatomy

<Canvas of={AvatarStories.Base} />

- **Image/Fallback Icon**: The circular user image or User icon fallback displayed when image is unavailable
- **Notification Indicator (optional)**: A red dot positioned at the top-right corner to indicate notifications
- **Container**: Rounded full background with muted-transparent styling

## Properties

### Overview

<Canvas of={AvatarStories.Base} />
<Controls of={AvatarStories.Base} />

### Size

Avatars come in two different sizes:

- **sm** (40px)
- **md** (48px, default)

<Canvas of={AvatarStories.SizeShowcase} />

### States

The Avatar component handles two primary states automatically:

- **With Image**: Displays the provided image when `src` is valid and loads successfully
- **Fallback**: Shows a User icon when `src` is undefined or the image fails to load

<Canvas of={AvatarStories.FallbackShowcase} />

### Notification Indicator

An optional notification indicator can be displayed to show status or alerts:

- **showNotification**: Boolean prop to toggle the notification dot (default: false)

<Canvas of={AvatarStories.NotificationShowcase} />

### As Interactive Trigger

Avatars are commonly used as interactive triggers for menus, dropdowns, or navigation:

<Canvas of={AvatarStories.InteractiveShowcase} />

## Accessibility

To be implemented:

- **Color contrast**
- **Text zoom support**
- **Semantic alt text for images**
- **Screen reader announcements for notification state**

</Tab>
<Tab label="Implementation">

```bash
npm install @ledgerhq/lumen-ui-react
```

> **Note**: `@ledgerhq/lumen-design-core` and other peer dependencies (`react`, `tailwindcss`, `clsx`, etc.) are required. See our [Setup Guide â†’](?path=/docs/getting-started-setup-tailwind--docs#1-tailwind-config) for complete installation and Tailwind configuration.

## Basic Usage

```tsx
import { Avatar } from '@ledgerhq/lumen-ui-react';

function MyComponent() {
  return <Avatar src="https://example.com/photo.jpg" size="md" />;
}
```

## Advanced Patterns

### Fallback Handling

The Avatar component automatically displays a fallback User icon when the image source is undefined or fails to load:

```tsx
import { Avatar } from '@ledgerhq/lumen-ui-react';

function MyComponent() {
  // Fallback will be shown automatically
  return <Avatar size="md" alt="User profile" />;
}
```

### With Notification

Display a notification indicator to show status or alerts:

```tsx
import { Avatar } from '@ledgerhq/lumen-ui-react';

function MyComponent() {
  const hasNotifications = true;
  
  return (
    <Avatar 
      src="https://example.com/photo.jpg" 
      showNotification={hasNotifications}
      size="md" 
    />
  );
}
```

### Different Sizes

Choose between small and medium sizes based on your layout needs:

```tsx
import { Avatar } from '@ledgerhq/lumen-ui-react';

function MyComponent() {
  return (
    <div className="flex items-center gap-8">
      <Avatar src="https://example.com/photo.jpg" size="sm" />
      <Avatar src="https://example.com/photo.jpg" size="md" />
    </div>
  );
}
```

### As Interactive Trigger

Avatars are commonly used as interactive triggers for menus, dropdowns, or navigation. Wrap the Avatar in a semantic HTML element (`<button>` or `<a>`) and add appropriate hover states:

```tsx
import { Avatar } from '@ledgerhq/lumen-ui-react';
import { Menu, MenuTrigger, MenuContent, MenuItem } from '@ledgerhq/lumen-ui-react';

function UserMenu() {
  return (
    <Menu>
      <MenuTrigger asChild>
        <button className="cursor-pointer rounded-full transition-colors hover:bg-muted-hover">
          <Avatar 
            src="https://example.com/photo.jpg"
            size="md" 
            alt="User menu" 
            showNotification 
          />
        </button>
      </MenuTrigger>
      <MenuContent>
        <MenuItem>Profile</MenuItem>
        <MenuItem>Settings</MenuItem>
        <MenuItem>Logout</MenuItem>
      </MenuContent>
    </Menu>
  );
}
```

**Key points:**
- Wrap Avatar in a semantic interactive element (`<button>` for actions, `<a>` for navigation)
- Use `rounded-full` to maintain circular hover area
- Add `transition-colors` and `hover:bg-muted-hover` for visual feedback
- Use `cursor-pointer` to indicate interactivity

### Image Loading Strategy

The `imgLoading` prop controls the **loading strategy for the avatar's image** (not the component itself). It allows you to optimize image loading performance based on where the avatar appears on your page.

> **Note**: This prop specifically controls when the browser loads the image resource. It does not affect the component's rendering or display state.

```tsx
import { Avatar } from '@ledgerhq/lumen-ui-react';

function UserList() {
  return (
    <div className="flex flex-col gap-8">
      {users.map((user) => (
        <Avatar
          key={user.id}
          src={user.avatarUrl}
          imgLoading="lazy"
          alt={user.name}
        />
      ))}
    </div>
  );
}
```

```tsx
import { Avatar } from '@ledgerhq/lumen-ui-react';

function UserProfile() {
  return (
    <Avatar
      src="https://example.com/photo.jpg"
      imgLoading="eager"
      alt="Current user profile"
    />
  );
}
```

### Custom Styling

While the component comes with predefined styles, you can extend them for layout purposes using Tailwind classes:

```tsx
<Avatar 
  src="https://example.com/photo.jpg" 
  size="md" 
  className="mr-8" // Layout positioning only
/>
```

## Do's and Don'ts

<div className='flex flex-col gap-24'>
  <DoVsDontRow>
    <DoBlockItem
      title='Provide descriptive alt text'
      description='Use meaningful alt text for better accessibility and screen reader support'
    >

{/* prettier-ignore */}
```tsx
<Avatar 
  src="https://example.com/photo.jpg" 
  alt="John Doe profile picture" 
/>
```

    </DoBlockItem>
    <DontBlockItem
      title="Don't omit alt text"
      description='Missing alt text reduces accessibility for screen reader users'
    >

{/* prettier-ignore */}
```tsx
<Avatar 
  src="https://example.com/photo.jpg" 
/>
```

    </DontBlockItem>

  </DoVsDontRow>

  <CommonRulesDoAndDont />
</div>

</Tab>
</CustomTabs>
