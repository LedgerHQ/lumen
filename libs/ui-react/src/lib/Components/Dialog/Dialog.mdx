import { Meta, Story, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as DialogStories from './Dialog.stories';
import {
  Dialog,
  DialogBody,
  DialogClose,
  DialogContent,
  DialogFooter,
  DialogHeader,
  DialogTrigger,
} from './Dialog';
import {
  CustomTabs,
  Tab,
  DoVsDontRow,
  DoBlockItem,
  DontBlockItem,
} from '../../../../.storybook/components';
import CommonRulesDoAndDont from '../../../../.storybook/components/DoVsDont/CommonRulesDoAndDont.mdx';

<Meta title='Components/Dialog' of={DialogStories} />

# ðŸªŸ Dialog

<CustomTabs>
  <Tab label="Overview">

## Introduction

Dialogs are modal windows that interrupt the normal workflow to grab the user's attention, typically for critical information, confirmation, or additional input.

> This Dialog component is built on top of [Radix UI Dialog](https://www.radix-ui.com/primitives/docs/components/dialog) primitives.

> View in [Figma](https://www.figma.com/design/JxaLVMTWirCpU0rsbZ30k7/2.-Components-Library?node-id=6345-2641&m=dev).

## Anatomy

<Canvas of={DialogStories.Base} />

<Controls of={DialogStories.Base} />

- **Trigger**: The element that opens the dialog when interacted with
- **Overlay**: Dimmed background that covers the underlying content
- **Header**: Use `DialogHeader` component for a consistent dialog header with title, description, and controls. The `onClose` prop is optional â€” the close button always dismisses the dialog via `DialogClose` internally, and `onClose` fires as a side-effect when provided
- **Close**: Use `DialogClose` to wrap any element that should dismiss the dialog when clicked (e.g., Cancel buttons)
- **Content**: The main container for dialog content
- **Body**: Scrollable area that expands to fill remaining space (use with `DialogBody`)
- **Footer**: Fixed bottom area for actions like buttons (use with `DialogFooter`)

> **Note**: The **width** of the dialog is `400px` by default, you can adjust the width of the dialog content by using the `className` prop on `DialogContent`.

## Properties

### Height

The dialog supports two height modes via the `height` prop on `Dialog`:

- **hug** (default): Content-fit height up to 560px max
- **fixed**: Always exactly 560px height

<Canvas of={DialogStories.HeightLayouts} />

### Footer

Use `DialogFooter` for dialogs with scrollable content and fixed actions:

- **DialogFooter**: Fixed at the bottom for action buttons
- Best used with `height="fixed"` to ensure consistent layout. 


<Canvas of={DialogStories.WithFooter} />

### Header Variants

Always use the `DialogHeader` component as the header for dialogs to maintain consistency. `DialogHeader` provides:

- Title and optional description
- Close button
- Optional back button for navigation
- Two appearance variants: `compact` and `extended`
- Automatic accessibility with proper ARIA roles

<Canvas of={DialogStories.HeaderVariants} />

### With multiple steps

For multi-step dialogs:

- Use `height="fixed"` to maintain consistent dialog height between steps
- Use `DialogFooter` for action buttons to keep them fixed at the bottom
- Use `DialogHeader`'s `onBack` prop to enable back navigation

<Canvas of={DialogStories.WithMultiSteps} />

### With Lists Content

When displaying lists (`ListItem`, `Tile`) inside a dialog, use **negative margins** to align content edge-to-edge with the dialog padding:

- Use negative margin for `ListItem` to align with dialog horizontal padding
- Use combination of negative margin and positive padding for horizontal scrollable `Tile` lists to allow edge-to-edge scrolling while maintaining content padding

<Canvas of={DialogStories.WithListsContent} />

## Examples

### Info State Variants

<Canvas of={DialogStories.InfoStateVariants} />

### Uncontrolled Pattern

Dialogs can be used without any explicit state management. The `DialogTrigger` handles opening, and `DialogClose` (used internally by `DialogHeader` and available for custom close buttons) handles closing:

<Canvas of={DialogStories.Uncontrolled} />

## Accessibility

Built-in accessibility features from Radix UI:

- **ARIA roles**: Automatically applies `role="dialog"` and `aria-modal="true"`
- **Focus trapping**: Focus is contained within the dialog when open
- **Keyboard navigation**: Press `ESC` to close the dialog
- **Focus management**: Focus returns to the trigger element on close
- **Screen reader support**: Uses `DialogTitle` and `DialogDescription` for proper announcements


</Tab>
<Tab label="Implementation">

```bash
npm install @ledgerhq/lumen-ui-react @radix-ui/react-dialog
```

> **Note**: `@ledgerhq/lumen-design-core` and other peer dependencies (`react`, `tailwindcss`, `clsx`, etc.) are required. See our [Setup Guide â†’](?path=/docs/getting-started-setup-tailwind--docs#1-tailwind-config) for complete installation and Tailwind configuration.

The `@radix-ui/react-dialog` dependency provides accessible dialog behavior primitives with custom styling and composition.

## Basic Usage

```tsx
import {
  Dialog,
  DialogBody,
  DialogContent,
  DialogHeader,
  DialogTrigger,
} from '@ledgerhq/lumen-ui-react';
import { Button } from '@ledgerhq/lumen-ui-react'; // Example trigger

function MyComponent() {
  return (
    <Dialog>
      <DialogTrigger asChild>
        <Button>Open Dialog</Button>
      </DialogTrigger>
      <DialogContent>
        <DialogHeader
          appearance='compact'
          title='Dialog Title'
          onClose={() => {
            /* handle close */
          }}
        />
        <DialogBody>
          Content here
        </DialogBody>
      </DialogContent>
    </Dialog>
  );
}
```

### Extended Appearance

Use extended `DialogHeader` for bigger dialogs:

```tsx
<Dialog>
  <DialogTrigger>Open Extended</DialogTrigger>
  <DialogContent className='w-[800px]'>
    <DialogHeader
      appearance='extended'
      title='Extended Dialog'
      onClose={() => {
        /* handle close */
      }}
    />
    <DialogBody>
      Extended content here
    </DialogBody>
  </DialogContent>
</Dialog>
```

### With Back Button

```tsx
<Dialog>
  <DialogTrigger>Open</DialogTrigger>
  <DialogContent>
    <DialogHeader
      appearance='compact'
      title='Title'
      onBack={() => console.log('Back')}
      onClose={() => {
        /* handle close */
      }}
    />
    <DialogBody>
      Content here
    </DialogBody>
  </DialogContent>
</Dialog>
```

### Custom Content Width

Control dialog width via className on DialogContent:

```tsx
<DialogContent className='w-[600px]'>{/* Content */}</DialogContent>
```

### Scrollable Content with Fixed Footer

Use `DialogBody` and `DialogFooter` for scrollable content with fixed actions:

```tsx
<Dialog height='fixed'>
  <DialogTrigger asChild>
    <Button>Open</Button>
  </DialogTrigger>
  <DialogContent>
    <DialogHeader title='Title' onClose={handleClose} />
    <DialogBody>
      {/* Scrollable content */}
      <div className='space-y-16'>{items.map((item) => /* ... */)}</div>
    </DialogBody>
    <DialogFooter>
      <Button appearance='base' size='lg' isFull>
        Confirm
      </Button>
    </DialogFooter>
  </DialogContent>
</Dialog>
```

### DialogClose

Use `DialogClose` to wrap any element that should dismiss the dialog when clicked. This is useful for Cancel or Done buttons in the dialog footer:

```tsx
import { DialogClose, Button } from '@ledgerhq/lumen-ui-react';

<DialogFooter>
  <DialogClose asChild>
    <Button appearance='no-background'>Cancel</Button>
  </DialogClose>
  <Button appearance='base'>Confirm</Button>
</DialogFooter>;
```

> **Note**: The `DialogHeader` close button automatically uses `DialogClose` internally, so the dialog always closes when the close button is clicked. The `onClose` prop on `DialogHeader` is optional â€” when provided, it fires as a side-effect callback (useful for analytics or cleanup).

### Uncontrolled Pattern

For simple dialogs that don't need external state management, use the uncontrolled pattern. No `open`, `onOpenChange`, or `onClose` props are needed:

```tsx
import {
  Dialog,
  DialogBody,
  DialogClose,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTrigger,
} from '@ledgerhq/lumen-ui-react';
import { Button } from '@ledgerhq/lumen-ui-react';

function MyDialog() {
  return (
    <Dialog>
      <DialogTrigger asChild>
        <Button>Open Dialog</Button>
      </DialogTrigger>
      <DialogContent>
        <DialogHeader appearance='compact' title='Simple Dialog' />
        <DialogBody>Content here</DialogBody>
        <DialogFooter>
          <DialogClose asChild>
            <Button appearance='no-background'>Cancel</Button>
          </DialogClose>
          <DialogClose asChild>
            <Button appearance='base'>Done</Button>
          </DialogClose>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

## Do's and Don'ts

<div className='flex flex-col gap-24'>

  <DoVsDontRow>
    <DoBlockItem
      title='Keep content simple'
      description='Use state to control open/close behavior'
    >

```tsx
<DialogContent>
  <DialogHeader ... />
  <DialogBody>
    <p>Simple text</p>
  </DialogBody>
</DialogContent>

const [open, setOpen] = useState(false);
<Dialog open={open} onOpenChange={setOpen}>
```

    </DoBlockItem>
    <DontBlockItem
      title="Don't put heavy content"
      description='Avoid heavy content or forcing dialog to always stay open'
    >

{/* prettier-ignore */}
```tsx
<DialogContent>
  <DialogHeader ... />
  <DialogBody>
    <ComplexChart />
  </DialogBody>
</DialogContent>
```

    </DontBlockItem>

  </DoVsDontRow>
</div>

<CommonRulesDoAndDont />

</Tab>
</CustomTabs>
